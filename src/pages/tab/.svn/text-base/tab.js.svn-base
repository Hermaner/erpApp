var Page = {
	subpages: E.subpages,
	activeTab: E.subpages[0],
	init: function() {
		this.vue = E.vue(this.vueObj), this.initConfig(), this.muiEvent()
	},
	initConfig: function() {
		var self = this;
		mui.init({});
		mui.plusReady(function() {
			var ws = plus.webview.currentWebview();
			for (var i = 0, len = self.subpages.length; i < len; i++) {
				(function(arg) {
					var sub = plus.webview.create(self.subpages[arg], self.subpages[arg], {
						top: '0px',
						bottom: '50px'
					});
					switch (arg) {
						case 0:
							self.homePage = sub;
							break;
						case 1:
							self.goodsPage = sub;
							sub.hide();
							break;
						case 2:
							self.orderPage = sub;
							sub.hide();
							break;
						case 3:
							self.morePage = sub;
							sub.hide();
							break;
						default:

					}
					ws.append(sub);
				})(i);
			};
			var old_back = mui.back;
			mui.back = function() {
				if (confirm("确定退出吗？")) {
					plus.runtime.quit();
				}
			};
			plus.push.addEventListener("click", function(msg) {
				var payload = msg.payload;
				if (payload.payload) {
					return
				}
				E.confirm('有新订单，是否立即跳转？', function() {
					self.goToDetail(payload)
				})
			}, false);
			plus.push.addEventListener("receive", function(msg) {
				var payload = msg.payload;
				if (payload.payload) {
					return
				}
				E.confirm('有新订单，是否立即跳转？', function() {
					self.goToDetail(payload)
				})
			}, false);
			document.addEventListener("resume", function() {
				self.resumeEvent()
			}, false);
		});
	},
	loadChild: function() {
		this.homePage.evalJS("Page.vue.loadData()");
		mui.preload({
			id: 'orderDetail',
			url: '../order/orderDetail.html',
		})
		mui.preload({
			id: 'pushSet',
			url: '../more/pushSet.html',
		})
		E.getWebview(E.preloadPages[1]).evalJS("pushPage.loadData()");
	},
	resumeEvent: function() {
		plus.runtime.setBadgeNumber(0);
		var url = mui(".mui-active")[0].getAttribute('data-href');
		
		this.loadEvent(url)
	},
	muiEvent: function() {
		var self = this
		mui("[data-href]").each(function() {
			this.addEventListener("tap", function() {
				var url = this.getAttribute("data-href");
				if (url == self.activeTab) return;
				self.loadEvent(url)
				E.showWebview(url), E.hideWebview(self.activeTab), self.activeTab = url;
			})
		})
	},
	loadEvent: function(c) {
		E.showLoading();
		switch (c) {
			case this.subpages[0]:
				this.homePage.evalJS("Page.vue.loadData()")
				break;
			case this.subpages[1]:
				this.goodsPage.evalJS("Page.vue.loadData('',1)")
				break;
			case this.subpages[2]:
				this.orderPage.evalJS("Page.vue.loadData('','',1)")
				break;
			default:
				E.closeLoading() 
				break;
		}
	},
	goToDetail: function(c) {
		E.fireData(E.preloadPages[0], 'detailShow', {
		  orderNumber: c
		})
	},
	addNavIcon: function(c) {
		this.vue.hasCount = c
	},
	orderBack: function(c) {
		E.showLoading()
		this.orderPage.evalJS("Page.vue.loadData('" + c + "','',1)");
		mui("a")[0].classList.remove("mui-active")
		mui("a")[2].classList.add("mui-active")
		this.activeTab = this.subpages[2];
	},
	moreBack: function() {
		mui("a")[3].classList.remove("mui-active")
		mui("a")[0].classList.add("mui-active")
		E.showWebview(this.subpages[0]), E.hideWebview(this.subpages[3])
		this.activeTab = this.subpages[0];
	},
	vueObj: {
		el: '#vue',
		data: {
			hasCount: false
		}
	}
};

Page.init()